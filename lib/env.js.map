{"version":3,"sources":["../src/env.js"],"names":["RUNTIME","WEB","WEEX","UNKNOWN","FRAMEWORK","VUE","RAX","PLATFORM","IOS","ANDROID","IPAD","maybeInWebView","window","maybeInWeexVueEnv","weex","maybeInNative","callNative","snifferWeexRaxMap","snifferWebViewMap","snifferWeexVueMap","snifferMachine","snifferMap","source","j","length","i","result","whichOneRuntime","getVirtualEnv","containerEnv","framework","config","env","platform","runtime","appVersion","appName","navigator","environment","virtualEnv","isWeb","isWeexiOS","isWeexAndroid","isWeex","UA","userAgent","toLowerCase","isWebiOS","test","isiPad","isWebAndroid","indexOf","split"],"mappings":"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","file":"env.js","sourcesContent":["const RUNTIME = {\n  WEB: 'Web',\n  WEEX: 'Weex',\n  UNKNOWN: 'Unknown'\n}\nconst FRAMEWORK = {\n  VUE: 'Vue',\n  RAX: 'Rax',\n  UNKNOWN: 'Unknown'\n};\nconst PLATFORM = {\n  IOS: 'iOS',\n  ANDROID: 'Android',\n  IPAD: 'iPad',\n  UNKNOWN: 'Unknown'\n}\n\nconst maybeInWebView = typeof window !== 'undefined';\nconst maybeInWeexVueEnv = typeof weex !== 'undefined';\nconst maybeInNative = typeof callNative !== 'undefined';\nconst snifferWeexRaxMap = [\n  '__weex_config__',\n  '__weex_options__',\n  '__weex_require__'\n];\nconst snifferWebViewMap = [\n  'localStorage',\n  'location',\n  'navigator',\n  'XMLHttpRequest'\n];\nconst snifferWeexVueMap = [\n  'config',\n  'requireModule',\n  'document'\n];\n\n// 嗅探器\nfunction snifferMachine(snifferMap,source){\n  const j = snifferMap.length;\n  let i = 0;\n  let result = true;\n  for(;i < j; i++){\n    if (!source[snifferMap[i]]){\n      result = false;\n      break;\n    }\n  }\n  return result;\n}\n\nfunction whichOneRuntime(){\n  if (maybeInWebView && maybeInWeexVueEnv){\n    // webview\n    return snifferMachine(snifferWeexVueMap,weex) ? 'Web.Vue' : 'Web.Unknown';\n  } else if (!maybeInWebView && maybeInWeexVueEnv){\n    // native\n    return snifferMachine(snifferWeexVueMap,weex) ? 'Weex.Vue' : 'Weex.Unknown';\n  } else if (maybeInWebView && maybeInNative && !maybeInWeexVueEnv){\n    // native\n    return snifferMachine(snifferWeexRaxMap,window) ? 'Weex.Rax' : 'Weex.Unknown';\n  } else {\n    // default webview\n    if (maybeInWebView){\n      return snifferMachine(snifferWebViewMap,window) ? 'Web.Unknown' : 'Unknown.Unknown';\n    } \n  }\n  return 'Unknown.Unknown';\n}\n\nfunction getVirtualEnv(){\n  let containerEnv = {};\n  switch (framework){\n    case FRAMEWORK.VUE:\n        const config = weex.config;\n        const env = config.env;\n        containerEnv.platform = env.platform;\n        if (RUNTIME.WEEX === runtime){\n          containerEnv.appVersion = env.appVersion;\n          containerEnv.appName = env.appName;\n        }\n      break;\n    case FRAMEWORK.RAX:\n        if (RUNTIME.WEEX === runtime) {\n          containerEnv.platform = navigator.platform;\n          containerEnv.appName = navigator.appName;\n          containerEnv.appVersion = navigator.appVersion;\n        }\n      break;\n    case FRAMEWORK.UNKNOWN:\n        if (RUNTIME.WEB === runtime){\n          containerEnv.platform = RUNTIME.WEB;\n        }\n        if (RUNTIME.UNKNOWN === runtime){\n          containerEnv.platform = RUNTIME.UNKNOWN;\n        }        \n      break;\n  }  \n  return containerEnv;\n}\n\nfunction environment(runtime,framework,virtualEnv){\n  const isWeb = virtualEnv.platform === 'Web';\n  const isWeexiOS = virtualEnv.platform === 'iOS';\n  const isWeexAndroid = virtualEnv.platform === 'android';\n  const isWeex = isWeexAndroid || isWeexiOS;\n  const UA = (() => {\n    if(isWeb){\n      return window.navigator.userAgent.toLowerCase();\n    }\n    return '';\n  })();\n  const isWebiOS = /iphone|ipod|ios/.test(UA);\n  const isiPad = /ipad/.test(UA);\n  const isWebAndroid = UA.indexOf('android') > -1;\n  let platform = '';\n  if (isWebiOS || isWeexiOS){\n    platform = PLATFORM.IOS;\n  } else if (isWebAndroid || isWeexAndroid){\n    platform = PLATFORM.ANDROID;\n  } else if (isiPad){\n    platform = PLATFORM.IPAD;\n  } else {\n    platform = PLATFORM.UNKNOWN;\n  }\n  return {\n    isWebiOS,\n    isWebAndroid,\n    isWeexiOS,\n    isWeexAndroid,\n    isiPad,\n    runtime,\n    framework,\n    platform\n  }\n}\n\nconst [ runtime, framework ] = whichOneRuntime().split('.');\nconst virtualEnv = getVirtualEnv();\nconst env = environment(runtime,framework,virtualEnv);\n\nexport default env;"]}